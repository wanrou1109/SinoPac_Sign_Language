{"ast":null,"code":"var _jsxFileName = \"/Users/linwanjou/Documents/GitHub/SinoPac_Sign_Language/\\u6C38\\u8C50\\u7522\\u5B78/App/src/components/SignLanguageRecognition.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport * as handsModule from \"@mediapipe/hands\";\nimport { drawConnectors, drawLandmarks } from \"@mediapipe/drawing_utils\";\nimport { Camera } from \"@mediapipe/camera_utils\";\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\nimport '../styles/SignLanguageRecognition.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SignLanguageRecognition = () => {\n  _s();\n  var _location$state;\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    addMessage,\n    editMessage,\n    setRecognitionStatus,\n    recognitionStatus,\n    setConversations\n  } = useAppContext();\n  const [isRecording, setIsRecording] = useState(false);\n  const [result, setResult] = useState('');\n  const [isProcessing, setIsProcessing] = useState(false);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const mediaRecorderRef = useRef(null);\n  const recordedChunksRef = useRef([]);\n  const streamRef = useRef(null);\n  const recognitionIntervalRef = useRef(null);\n  const lastRecognizedTextRef = useRef('');\n  const resultBoxRef = useRef(null);\n  const keypointsBuffer = useRef([]);\n  const finalResultRef = useRef(''); // ËøΩËπ§ÊúÄÁµÇÁµêÊûú\n  const editMessageID = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.messageID;\n  useEffect(() => {\n    const setupCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true\n        });\n        streamRef.current = stream;\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n        }\n        // MediaPipe Hands integration\n        const hands = new handsModule.Hands({\n          locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`\n        });\n        hands.setOptions({\n          maxNumHands: 2,\n          modelComplexity: 1,\n          minDetectionConfidence: 0.7,\n          minTrackingConfidence: 0.5\n        });\n        hands.onResults(results => {\n          const canvasCtx = canvasRef.current.getContext('2d');\n          canvasCtx.clearRect(0, 0, 640, 480);\n          // Draw the video frame onto the canvas first (Ê∞¥Âπ≥ÂèçËΩâÈ°ØÁ§∫ÂΩ±ÂÉè)\n          canvasCtx.save();\n          canvasCtx.translate(640, 0);\n          canvasCtx.scale(-1, 1);\n          if (videoRef.current) {\n            canvasCtx.drawImage(videoRef.current, 0, 0, 640, 480);\n          }\n          // Áï´ÊâãÈÉ®ËºîÂä©Á∑öËàáÊ®ôÁ±§ÔºàÊ®ôÁ±§‰ΩçÁΩÆÊ†πÊìöÈè°ÂÉèÂæåÁöÑÊñπÂêë‰øÆÊ≠£Ôºâ\n          if (results.multiHandLandmarks) {\n            for (let i = 0; i < results.multiHandLandmarks.length; i++) {\n              var _results$multiHandedn, _results$multiHandedn2;\n              const landmarks = results.multiHandLandmarks[i];\n              let handedness = ((_results$multiHandedn = results.multiHandedness) === null || _results$multiHandedn === void 0 ? void 0 : (_results$multiHandedn2 = _results$multiHandedn[i]) === null || _results$multiHandedn2 === void 0 ? void 0 : _results$multiHandedn2.label) || '';\n              // Ê∞¥Âπ≥Èè°ÂÉè landmarks\n              const flippedLandmarks = landmarks.map(pt => ({\n                ...pt,\n                x: 1.0 - pt.x // Ê∞¥Âπ≥ÂèçËΩâÂ∫ßÊ®ô\n              }));\n              // ‰ΩøÁî®Èè°ÂÉèÂæåÁöÑÂ∫ßÊ®ô‰ΩúÁÇ∫Ê®ôÁ±§‰ΩçÁΩÆ\n              const cx = flippedLandmarks[0].x * 640;\n              const cy = flippedLandmarks[0].y * 480;\n              drawConnectors(canvasCtx, flippedLandmarks, handsModule.HAND_CONNECTIONS, {\n                color: '#00FF00',\n                lineWidth: 2\n              });\n              drawLandmarks(canvasCtx, flippedLandmarks, {\n                color: '#FF0000',\n                lineWidth: 1\n              });\n              canvasCtx.font = \"16px Arial\";\n              canvasCtx.fillStyle = \"blue\";\n              // Flip text horizontally back to normal\n              canvasCtx.save();\n              canvasCtx.scale(-1, 1);\n              canvasCtx.fillText(handedness, -cx, cy - 10);\n              canvasCtx.restore();\n            }\n          }\n          canvasCtx.restore();\n          if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {\n            let leftHand = null;\n            let rightHand = null;\n            for (let i = 0; i < results.multiHandLandmarks.length; i++) {\n              var _results$multiHandedn3, _results$multiHandedn4;\n              const handLabel = (_results$multiHandedn3 = results.multiHandedness) === null || _results$multiHandedn3 === void 0 ? void 0 : (_results$multiHandedn4 = _results$multiHandedn3[i]) === null || _results$multiHandedn4 === void 0 ? void 0 : _results$multiHandedn4.label;\n              if (handLabel === 'Left') {\n                leftHand = results.multiHandLandmarks[i];\n              } else if (handLabel === 'Right') {\n                rightHand = results.multiHandLandmarks[i];\n              }\n            }\n            const leftFlat = leftHand ? leftHand.flatMap(pt => [pt.x, pt.y, pt.z]) : new Array(63).fill(0);\n            const rightFlat = rightHand ? rightHand.flatMap(pt => [pt.x, pt.y, pt.z]) : new Array(63).fill(0);\n            const combined = [...leftFlat, ...rightFlat]; // ÊØèÂπÄÁÇ∫ 126 Á∂≠\n\n            keypointsBuffer.current.push(combined);\n            if (keypointsBuffer.current.length > 30) {\n              keypointsBuffer.current.shift();\n            }\n            window.keypointsArray = [...keypointsBuffer.current];\n          } else {\n            keypointsBuffer.current = [];\n            window.keypointsArray = [];\n          }\n        });\n        const camera = new Camera(videoRef.current, {\n          onFrame: async () => {\n            const video = videoRef.current;\n\n            // Á¢∫Ë™ç video Â≠òÂú®‰∏îÁï´Èù¢Â∑≤Ê∫ñÂÇôÂ•ΩÔºàreadyState >= 2Ôºâ\n            if (!video || video.readyState < 2) {\n              console.warn('Ë∑≥ÈÅéÂ∞öÊú™Ê∫ñÂÇôÂ•ΩÁöÑ video Áï´Èù¢');\n              return;\n            }\n            const flippedCanvas = document.createElement('canvas');\n            flippedCanvas.width = 640;\n            flippedCanvas.height = 480;\n            const flippedCtx = flippedCanvas.getContext('2d');\n            flippedCtx.translate(640, 0);\n            flippedCtx.scale(-1, 1);\n            flippedCtx.drawImage(video, 0, 0, 640, 480);\n            await hands.send({\n              image: flippedCanvas\n            });\n          },\n          width: 640,\n          height: 480\n        });\n        camera.start();\n      } catch (error) {\n        console.error('Èè°È†≠ÈñãÂïüÂ§±Êïó:', error);\n        alert('ÁÑ°Ê≥ïÈñãÂïüÈè°È†≠ÔºåË´ãÁ¢∫Ë™çÂ∑≤Êéà‰∫àÊîùÂΩ±Ê©üÊ¨äÈôê„ÄÇ');\n      }\n    };\n    setupCamera();\n    return () => {\n      if (streamRef.current) {\n        streamRef.current.getTracks().forEach(track => track.stop());\n      }\n      if (recognitionIntervalRef.current) {\n        clearInterval(recognitionIntervalRef.current);\n        recognitionIntervalRef.current = null;\n      }\n    };\n  }, []);\n  useEffect(() => {\n    console.log('ÈñãÂßãÊ∏¨Ë©¶ËàáÂæåÁ´ØÁöÑÈÄ£Êé•...');\n    fetch('/api/test').then(response => {\n      if (!response.ok) {\n        throw new Error(`ÂæåÁ´ØÈåØË™§Ôºö${response.status}`);\n      }\n      return response.json();\n    }).then(data => console.log('ÂæåÁ´ØÈÄ£Êé•Ê∏¨Ë©¶ÊàêÂäü:', data)).catch(error => console.error('ÂæåÁ´ØÈÄ£Êé•ÈåØË™§:', error));\n  }, []);\n\n  // Âç≥ÊôÇËæ®Ë≠ò\n  const startPeriodicRecognition = () => {\n    console.log('üéØ ÂïüÂãïÂÆöÊúüËæ®Ë≠ò');\n    recognitionIntervalRef.current = setInterval(() => {\n      if (!isProcessing) {\n        captureAndRecognize();\n      }\n    }, 1000);\n  };\n  const captureAndRecognize = async () => {\n    if (!videoRef.current || !streamRef.current) return;\n    try {\n      setIsProcessing(true);\n      // ÂÇ≥ÈÄÅÂà∞ÂæåÁ´ØÔºåÂª∂ÈÅ≤ 0 ÊØ´Áßí\n      setTimeout(() => {\n        sendFrameToRecognition();\n      }, 0);\n    } catch (err) {\n      console.error('ËôïÁêÜÂΩ±ÁâáÂπÄÊôÇÁôºÁîüÈåØË™§Ôºö', err);\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  const sendFrameToRecognition = async () => {\n    try {\n      const keypointsArray = window.keypointsArray;\n      if (!keypointsArray || keypointsArray.length !== 30) {\n        // ‰∏çË¶ÅÊããÂá∫ÈåØË™§ÔºåÂè™ÊòØËøîÂõûÔºåÈÅøÂÖç‰∏≠Êñ∑ÊµÅÁ®ã\n        console.log('keypointsArray Ë≥áÊñô‰∏çË∂≥ÔºåÈúÄ 30 ÂπÄÔºåÁï∂Ââç:', (keypointsArray === null || keypointsArray === void 0 ? void 0 : keypointsArray.length) || 0);\n        return;\n      }\n      const totalLength = keypointsArray.reduce((sum, row) => sum + row.length, 0);\n      if (totalLength !== 30 * 126) {\n        console.log(`Ê†ºÂºèÈåØË™§ÔºåÊáâÁÇ∫ (30, 126)ÔºåÁõÆÂâçÁÇ∫ (30, ${totalLength / 30})`);\n        return;\n      }\n      console.log('ÁôºÈÄÅÁØÄÈªûË≥áÊñôÈÄ≤Ë°åËæ®Ë≠ò...');\n      const response = await fetch('/api/sign-language-recognition/frame', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          keypoints: keypointsArray\n        })\n      });\n      if (!response.ok) {\n        throw new Error(`‰º∫ÊúçÂô®ÈåØË™§Ôºö ${response.status}`);\n      }\n      const data = await response.json();\n      console.log('Ëæ®Ë≠òÁµêÊûúÔºö', data);\n      if (data.success === true && data.text && data.text.trim() !== '') {\n        console.log('ËôïÁêÜÊàêÂäüÁöÑËæ®Ë≠òÊñáÊú¨:', data.text);\n\n        // ËôïÁêÜÁâπÊÆäÊÉÖÊ≥ÅÔºöËº∏ÂÖ•ÂÆåÊàê\n        if (data.text === 'Ëº∏ÂÖ•ÂÆåÊàê' && data.raw_label) {\n          console.log('ËôïÁêÜËº∏ÂÖ•ÂÆåÊàê');\n          setResult(prev => {\n            const newResult = prev + '\\n' + data.raw_label;\n            finalResultRef.current = newResult; // ÂêåÊ≠•Êõ¥Êñ∞ ref\n            console.log('üìù Ëº∏ÂÖ•ÂÆåÊàê - Êñ∞ÁµêÊûú:', newResult);\n            return newResult;\n          });\n          return;\n        }\n\n        // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Êï∏Â≠ó\n        const isDigit = /^\\d$/.test(data.text);\n        console.log('ÊòØÂê¶ÁÇ∫Êï∏Â≠ó:', isDigit);\n        if (isDigit) {\n          console.log('Ê∑ªÂä†Êï∏Â≠ó:', data.text);\n          lastRecognizedTextRef.current = data.text;\n          setResult(prev => {\n            const newResult = prev + data.text;\n            finalResultRef.current = newResult; // ÂêåÊ≠•Êõ¥Êñ∞ ref\n            console.log('Êï∏Â≠ó - Êñ∞ÁµêÊûú:', newResult);\n            return newResult;\n          });\n          return;\n        }\n\n        // ËôïÁêÜÈùûÊï∏Â≠óÔºöÂè™ÊúâËàá‰∏ä‰∏ÄÂÄã‰∏çÂêåÊâçÊ∑ªÂä†\n        if (data.text !== lastRecognizedTextRef.current) {\n          console.log('Ê∑ªÂä†ÈùûÈáçË§áÊñáÊú¨:', data.text);\n          lastRecognizedTextRef.current = data.text;\n          setResult(prev => {\n            const newResult = prev + data.text;\n            finalResultRef.current = newResult; // ÂêåÊ≠•Êõ¥Êñ∞ ref\n            return newResult;\n          });\n        }\n      } else {\n        console.log('Ë∑≥ÈÅéÁÑ°ÊïàÁµêÊûú');\n        if (data.success !== true) console.log('  - success ‰∏çÁÇ∫ true:', data.success);\n        if (!data.text) console.log('  - text ÁÇ∫Á©∫Êàñ‰∏çÂ≠òÂú®:', data.text);\n        if (data.error) console.log('  - ÈåØË™§‰ø°ÊÅØ:', data.error);\n      }\n    } catch (err) {\n      console.error('ÁôºÈÄÅÁØÄÈªûÂà∞ÂæåÁ´ØÊôÇÁôºÁîüÈåØË™§Ôºö', err);\n    }\n  };\n  const updateRecognizedText = newText => {\n    if (!newText || newText.trim() === '') return;\n    setResult(prevText => {\n      const lastText = lastRecognizedTextRef.current;\n      if (newText === \"Ë´ãÊâì‰∏ã‰∏ÄÂÄãÂ≠ó\") {\n        return prevText + '\\nË´ãÊâì‰∏ã‰∏ÄÂÄãÂ≠ó';\n      }\n      if (newText === lastText) {\n        return prevText;\n      }\n      return prevText + newText;\n    });\n  };\n  const handleStartRecording = () => {\n    if (!streamRef.current) {\n      alert('Èè°È†≠Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');\n      return;\n    }\n    setResult('');\n    lastRecognizedTextRef.current = '';\n    finalResultRef.current = '';\n    recordedChunksRef.current = [];\n    const mediaRecorder = new MediaRecorder(streamRef.current, {\n      mimeType: 'video/webm'\n    });\n    mediaRecorder.ondataavailable = event => {\n      if (event.data.size > 0) {\n        recordedChunksRef.current.push(event.data);\n        console.log(`Êî∂Âà∞ÈåÑË£ΩÁâáÊÆµ: ${event.data.size} bytes`);\n      }\n    };\n    mediaRecorder.onstop = async () => {\n      if (recognitionIntervalRef.current) {\n        clearInterval(recognitionIntervalRef.current);\n        recognitionIntervalRef.current = null;\n      }\n      try {\n        const blob = new Blob(recordedChunksRef.current, {\n          type: 'video/webm'\n        });\n        if (blob.size === 0) throw new Error('Ë¶ñË®äÊ™îÊ°àÁÇ∫Á©∫');\n        setTimeout(() => {\n          setRecognitionStatus('idle');\n          const finalResult = finalResultRef.current || 'ÁÑ°Ëæ®Ë≠òÁµêÊûú';\n          console.log('ÊúÄÁµÇËæ®Ë≠òÁµêÊûú:', finalResult);\n          if (editMessageID) {\n            editMessage(editMessageID, finalResult);\n          } else {\n            addMessage(finalResult, 'customer');\n          }\n          navigate('/conversation');\n        }, 1000);\n      } catch (err) {\n        console.error('ËôïÁêÜÈåÑË£ΩÈåØË™§:', err);\n        alert('Ëæ®Ë≠òÂ§±Êïó: ' + err.message);\n        setRecognitionStatus('idle');\n      }\n    };\n    mediaRecorderRef.current = mediaRecorder;\n    mediaRecorder.start(1000);\n    setIsRecording(true);\n    setRecognitionStatus('recording');\n    startPeriodicRecognition();\n  };\n  const handleStopRecording = () => {\n    console.log('finalResultRef:', finalResultRef.current);\n    if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {\n      mediaRecorderRef.current.stop();\n    }\n    if (recognitionIntervalRef.current) {\n      clearInterval(recognitionIntervalRef.current);\n      recognitionIntervalRef.current = null;\n    }\n    setIsRecording(false);\n    setRecognitionStatus('processing');\n  };\n  const handleBack = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n    }\n    if (recognitionIntervalRef.current) {\n      clearInterval(recognitionIntervalRef.current);\n      recognitionIntervalRef.current = null;\n    }\n    setIsRecording(false);\n    setRecognitionStatus('idle');\n    navigate('/conversation');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"sign-language-recognition-screen\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      showBackButton: true,\n      onBack: handleBack\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 387,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"recognition-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-container\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n        ref: videoRef,\n        autoPlay: true,\n        playsInline: true,\n        muted: true,\n        style: {\n          display: 'none'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n        ref: canvasRef,\n        className: \"overlay-canvas\",\n        width: 640,\n        height: 480\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 17\n      }, this), isProcessing && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"processing-indicator\",\n        children: \"\\u8FA8\\u8B58\\u4E2D...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 388,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `recognition-result ${isRecording ? 'visible' : 'hidden'}`,\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"\\u5373\\u6642\\u8FA8\\u8B58\\u7D50\\u679C\\uFF1A\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: resultBoxRef,\n        className: `result-text ${result ? 'has-content' : ''}`,\n        children: result ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"recognized-summary\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"prompt\",\n            children: \"\\u8ACB\\u6253\\u4E0B\\u4E00\\u500B\\u5B57\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"\\u76EE\\u524D\\u5DF2\\u8F38\\u5165\\uFF1A\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 418,\n              columnNumber: 34\n            }, this), \" \", result.replace(/Ë´ãÊâì‰∏ã‰∏ÄÂÄãÂ≠ó/g, '').trim()]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 416,\n          columnNumber: 25\n        }, this) : 'Á≠âÂæÖÊâãË™ûËæ®Ë≠ò...'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 411,\n        columnNumber: 17\n      }, this), isRecording && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"live-indicator\",\n        children: \"\\u5373\\u6642\\u66F4\\u65B0\\u4E2D\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 33\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 409,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"action-bar\",\n      children: !isRecording ? /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"record-button\",\n        onClick: handleStartRecording,\n        disabled: recognitionStatus === 'processing',\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-inner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 431,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 426,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"record-button recording-active\",\n        onClick: handleStopRecording,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-inner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 438,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 434,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 424,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 386,\n    columnNumber: 9\n  }, this);\n};\n_s(SignLanguageRecognition, \"ymKWlsSsU2XExu/TDBnw7a94gzw=\", false, function () {\n  return [useNavigate, useLocation, useAppContext];\n});\n_c = SignLanguageRecognition;\nexport default SignLanguageRecognition;\nvar _c;\n$RefreshReg$(_c, \"SignLanguageRecognition\");","map":{"version":3,"names":["React","useState","useEffect","useRef","handsModule","drawConnectors","drawLandmarks","Camera","useNavigate","useLocation","useAppContext","Header","jsxDEV","_jsxDEV","SignLanguageRecognition","_s","_location$state","navigate","location","addMessage","editMessage","setRecognitionStatus","recognitionStatus","setConversations","isRecording","setIsRecording","result","setResult","isProcessing","setIsProcessing","videoRef","canvasRef","mediaRecorderRef","recordedChunksRef","streamRef","recognitionIntervalRef","lastRecognizedTextRef","resultBoxRef","keypointsBuffer","finalResultRef","editMessageID","state","messageID","setupCamera","stream","navigator","mediaDevices","getUserMedia","video","current","srcObject","hands","Hands","locateFile","file","setOptions","maxNumHands","modelComplexity","minDetectionConfidence","minTrackingConfidence","onResults","results","canvasCtx","getContext","clearRect","save","translate","scale","drawImage","multiHandLandmarks","i","length","_results$multiHandedn","_results$multiHandedn2","landmarks","handedness","multiHandedness","label","flippedLandmarks","map","pt","x","cx","cy","y","HAND_CONNECTIONS","color","lineWidth","font","fillStyle","fillText","restore","leftHand","rightHand","_results$multiHandedn3","_results$multiHandedn4","handLabel","leftFlat","flatMap","z","Array","fill","rightFlat","combined","push","shift","window","keypointsArray","camera","onFrame","readyState","console","warn","flippedCanvas","document","createElement","width","height","flippedCtx","send","image","start","error","alert","getTracks","forEach","track","stop","clearInterval","log","fetch","then","response","ok","Error","status","json","data","catch","startPeriodicRecognition","setInterval","captureAndRecognize","setTimeout","sendFrameToRecognition","err","totalLength","reduce","sum","row","method","headers","body","JSON","stringify","keypoints","success","text","trim","raw_label","prev","newResult","isDigit","test","updateRecognizedText","newText","prevText","lastText","handleStartRecording","mediaRecorder","MediaRecorder","mimeType","ondataavailable","event","size","onstop","blob","Blob","type","finalResult","message","handleStopRecording","handleBack","className","children","showBackButton","onBack","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline","muted","style","display","replace","onClick","disabled","_c","$RefreshReg$"],"sources":["/Users/linwanjou/Documents/GitHub/SinoPac_Sign_Language/Ê∞∏Ë±êÁî¢Â≠∏/App/src/components/SignLanguageRecognition.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport * as handsModule from \"@mediapipe/hands\";\nimport { drawConnectors, drawLandmarks } from \"@mediapipe/drawing_utils\";\nimport { Camera } from \"@mediapipe/camera_utils\";\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\nimport '../styles/SignLanguageRecognition.css';\n\nconst SignLanguageRecognition = () => {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const { addMessage, editMessage, setRecognitionStatus, recognitionStatus, setConversations } = useAppContext();\n    const [isRecording, setIsRecording] = useState(false);\n    const [result, setResult] = useState('');\n    const [isProcessing, setIsProcessing] = useState(false);\n    const videoRef = useRef(null);\n    const canvasRef = useRef(null);\n    const mediaRecorderRef = useRef(null);\n    const recordedChunksRef = useRef([]);\n    const streamRef = useRef(null);\n    const recognitionIntervalRef = useRef(null);\n    const lastRecognizedTextRef = useRef('');\n    const resultBoxRef = useRef(null);\n    const keypointsBuffer = useRef([]);\n    const finalResultRef = useRef(''); // ËøΩËπ§ÊúÄÁµÇÁµêÊûú\n    const editMessageID = location.state?.messageID;\n    \n    useEffect(() => {\n        const setupCamera = async () => {\n            try {\n                const stream = await navigator.mediaDevices.getUserMedia({ video: true });\n                streamRef.current = stream;\n                if (videoRef.current) {\n                    videoRef.current.srcObject = stream;\n                }\n                // MediaPipe Hands integration\n                const hands = new handsModule.Hands({\n                    locateFile: (file) =>\n                        `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`,\n                });\n\n                hands.setOptions({\n                    maxNumHands: 2,\n                    modelComplexity: 1,\n                    minDetectionConfidence: 0.7,\n                    minTrackingConfidence: 0.5,\n                });\n                hands.onResults((results) => {\n                    const canvasCtx = canvasRef.current.getContext('2d');\n                    canvasCtx.clearRect(0, 0, 640, 480);\n                    // Draw the video frame onto the canvas first (Ê∞¥Âπ≥ÂèçËΩâÈ°ØÁ§∫ÂΩ±ÂÉè)\n                    canvasCtx.save();\n                    canvasCtx.translate(640, 0);\n                    canvasCtx.scale(-1, 1);\n                    if (videoRef.current) {\n                        canvasCtx.drawImage(videoRef.current, 0, 0, 640, 480);\n                    }\n                    // Áï´ÊâãÈÉ®ËºîÂä©Á∑öËàáÊ®ôÁ±§ÔºàÊ®ôÁ±§‰ΩçÁΩÆÊ†πÊìöÈè°ÂÉèÂæåÁöÑÊñπÂêë‰øÆÊ≠£Ôºâ\n                    if (results.multiHandLandmarks) {\n                        for (let i = 0; i < results.multiHandLandmarks.length; i++) {\n                            const landmarks = results.multiHandLandmarks[i];\n                            let handedness = results.multiHandedness?.[i]?.label || '';\n                            // Ê∞¥Âπ≥Èè°ÂÉè landmarks\n                            const flippedLandmarks = landmarks.map(pt => ({\n                                ...pt,\n                                x: 1.0 - pt.x // Ê∞¥Âπ≥ÂèçËΩâÂ∫ßÊ®ô\n                            }));\n                            // ‰ΩøÁî®Èè°ÂÉèÂæåÁöÑÂ∫ßÊ®ô‰ΩúÁÇ∫Ê®ôÁ±§‰ΩçÁΩÆ\n                            const cx = flippedLandmarks[0].x * 640;\n                            const cy = flippedLandmarks[0].y * 480;\n\n                            drawConnectors(canvasCtx, flippedLandmarks, handsModule.HAND_CONNECTIONS, { color: '#00FF00', lineWidth: 2 });\n                            drawLandmarks(canvasCtx, flippedLandmarks, { color: '#FF0000', lineWidth: 1 });\n\n                            canvasCtx.font = \"16px Arial\";\n                            canvasCtx.fillStyle = \"blue\";\n                            // Flip text horizontally back to normal\n                            canvasCtx.save();\n                            canvasCtx.scale(-1, 1);\n                            canvasCtx.fillText(handedness, -cx, cy - 10);\n                            canvasCtx.restore();\n                        }\n                    }\n                    canvasCtx.restore();\n\n                    if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {\n                        let leftHand = null;\n                        let rightHand = null;\n\n                        for (let i = 0; i < results.multiHandLandmarks.length; i++) {\n                            const handLabel = results.multiHandedness?.[i]?.label;\n                            if (handLabel === 'Left') {\n                                leftHand = results.multiHandLandmarks[i];\n                            } else if (handLabel === 'Right') {\n                                rightHand = results.multiHandLandmarks[i];\n                            }\n                        }\n                        const leftFlat = leftHand ? leftHand.flatMap(pt => [pt.x, pt.y, pt.z]) : new Array(63).fill(0);\n                        const rightFlat = rightHand ? rightHand.flatMap(pt => [pt.x, pt.y, pt.z]) : new Array(63).fill(0);\n\n                        const combined = [...leftFlat, ...rightFlat]; // ÊØèÂπÄÁÇ∫ 126 Á∂≠\n\n                        keypointsBuffer.current.push(combined);\n                        if (keypointsBuffer.current.length > 30) {\n                            keypointsBuffer.current.shift();\n                        }\n\n                        window.keypointsArray = [...keypointsBuffer.current];\n                    } else {\n                        keypointsBuffer.current = [];\n                        window.keypointsArray = [];\n                    }\n                });\n\n                const camera = new Camera(videoRef.current, {\n                    onFrame: async () => {\n                        const video = videoRef.current;\n\n                        // Á¢∫Ë™ç video Â≠òÂú®‰∏îÁï´Èù¢Â∑≤Ê∫ñÂÇôÂ•ΩÔºàreadyState >= 2Ôºâ\n                        if (!video || video.readyState < 2) {\n                            console.warn('Ë∑≥ÈÅéÂ∞öÊú™Ê∫ñÂÇôÂ•ΩÁöÑ video Áï´Èù¢');\n                            return;\n                        }\n\n                        const flippedCanvas = document.createElement('canvas');\n                        flippedCanvas.width = 640;\n                        flippedCanvas.height = 480;\n                        const flippedCtx = flippedCanvas.getContext('2d');\n\n                        flippedCtx.translate(640, 0);\n                        flippedCtx.scale(-1, 1);\n                        flippedCtx.drawImage(video, 0, 0, 640, 480);\n\n                        await hands.send({ image: flippedCanvas });\n                    },\n                    width: 640,\n                    height: 480,\n                });\n                camera.start();\n            } catch (error) {\n                console.error('Èè°È†≠ÈñãÂïüÂ§±Êïó:', error);\n                alert('ÁÑ°Ê≥ïÈñãÂïüÈè°È†≠ÔºåË´ãÁ¢∫Ë™çÂ∑≤Êéà‰∫àÊîùÂΩ±Ê©üÊ¨äÈôê„ÄÇ');\n            }\n        };\n\n        setupCamera();\n\n        return () => {\n            if (streamRef.current) {\n                streamRef.current.getTracks().forEach(track => track.stop());\n            }\n\n            if (recognitionIntervalRef.current) {\n                clearInterval(recognitionIntervalRef.current);\n                recognitionIntervalRef.current = null;\n            }\n        };\n    }, []);\n\n    useEffect(() => {\n        console.log('ÈñãÂßãÊ∏¨Ë©¶ËàáÂæåÁ´ØÁöÑÈÄ£Êé•...');\n        fetch('/api/test')\n        .then(response => {\n            if (!response.ok) {\n            throw new Error(`ÂæåÁ´ØÈåØË™§Ôºö${response.status}`);\n            }\n            return response.json();\n        })\n        .then(data => console.log('ÂæåÁ´ØÈÄ£Êé•Ê∏¨Ë©¶ÊàêÂäü:', data))\n        .catch(error => console.error('ÂæåÁ´ØÈÄ£Êé•ÈåØË™§:', error));\n    }, []);\n\n    // Âç≥ÊôÇËæ®Ë≠ò\n    const startPeriodicRecognition = () => {\n        console.log('üéØ ÂïüÂãïÂÆöÊúüËæ®Ë≠ò');\n        recognitionIntervalRef.current = setInterval(() => {\n            if (!isProcessing) {\n                captureAndRecognize();\n            }\n        }, 1000);\n    };\n\n    const captureAndRecognize = async () => {\n        if (!videoRef.current || !streamRef.current) return;\n\n        try {\n            setIsProcessing(true);\n            // ÂÇ≥ÈÄÅÂà∞ÂæåÁ´ØÔºåÂª∂ÈÅ≤ 0 ÊØ´Áßí\n            setTimeout(() => {\n                sendFrameToRecognition();\n            }, 0);\n        } catch (err) {\n            console.error('ËôïÁêÜÂΩ±ÁâáÂπÄÊôÇÁôºÁîüÈåØË™§Ôºö', err);\n        } finally {\n            setIsProcessing(false);\n        }\n    };\n\n    const sendFrameToRecognition = async () => {\n        try {\n            const keypointsArray = window.keypointsArray;\n            if (!keypointsArray || keypointsArray.length !== 30) {\n                // ‰∏çË¶ÅÊããÂá∫ÈåØË™§ÔºåÂè™ÊòØËøîÂõûÔºåÈÅøÂÖç‰∏≠Êñ∑ÊµÅÁ®ã\n                console.log('keypointsArray Ë≥áÊñô‰∏çË∂≥ÔºåÈúÄ 30 ÂπÄÔºåÁï∂Ââç:', keypointsArray?.length || 0);\n                return;\n            }\n\n            const totalLength = keypointsArray.reduce((sum, row) => sum + row.length, 0);\n            if (totalLength !== 30 * 126) {\n                console.log(`Ê†ºÂºèÈåØË™§ÔºåÊáâÁÇ∫ (30, 126)ÔºåÁõÆÂâçÁÇ∫ (30, ${totalLength / 30})`);\n                return;\n            }\n            \n            console.log('ÁôºÈÄÅÁØÄÈªûË≥áÊñôÈÄ≤Ë°åËæ®Ë≠ò...');\n            const response = await fetch('/api/sign-language-recognition/frame', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({ keypoints: keypointsArray })\n            });\n            \n            if (!response.ok) {\n                throw new Error(`‰º∫ÊúçÂô®ÈåØË™§Ôºö ${response.status}`);\n            }\n\n            const data = await response.json();\n            console.log('Ëæ®Ë≠òÁµêÊûúÔºö', data);\n\n            if (data.success === true && data.text && data.text.trim() !== '') {\n                console.log('ËôïÁêÜÊàêÂäüÁöÑËæ®Ë≠òÊñáÊú¨:', data.text);\n                \n                // ËôïÁêÜÁâπÊÆäÊÉÖÊ≥ÅÔºöËº∏ÂÖ•ÂÆåÊàê\n                if (data.text === 'Ëº∏ÂÖ•ÂÆåÊàê' && data.raw_label) {\n                    console.log('ËôïÁêÜËº∏ÂÖ•ÂÆåÊàê');\n                    setResult(prev => {\n                        const newResult = prev + '\\n' + data.raw_label;\n                        finalResultRef.current = newResult; // ÂêåÊ≠•Êõ¥Êñ∞ ref\n                        console.log('üìù Ëº∏ÂÖ•ÂÆåÊàê - Êñ∞ÁµêÊûú:', newResult);\n                        return newResult;\n                    });\n                    return;\n                }\n                \n                // Ê™¢Êü•ÊòØÂê¶ÁÇ∫Êï∏Â≠ó\n                const isDigit = /^\\d$/.test(data.text);\n                console.log('ÊòØÂê¶ÁÇ∫Êï∏Â≠ó:', isDigit);\n                \n                if (isDigit) {\n                    console.log('Ê∑ªÂä†Êï∏Â≠ó:', data.text);\n                    lastRecognizedTextRef.current = data.text;\n                    setResult(prev => {\n                        const newResult = prev + data.text;\n                        finalResultRef.current = newResult; // ÂêåÊ≠•Êõ¥Êñ∞ ref\n                        console.log('Êï∏Â≠ó - Êñ∞ÁµêÊûú:', newResult);\n                        return newResult;\n                    });\n                    return;\n                }\n                \n                // ËôïÁêÜÈùûÊï∏Â≠óÔºöÂè™ÊúâËàá‰∏ä‰∏ÄÂÄã‰∏çÂêåÊâçÊ∑ªÂä†\n                if (data.text !== lastRecognizedTextRef.current) {\n                    console.log('Ê∑ªÂä†ÈùûÈáçË§áÊñáÊú¨:', data.text);\n                    lastRecognizedTextRef.current = data.text;\n                    setResult(prev => {\n                        const newResult = prev + data.text;\n                        finalResultRef.current = newResult; // ÂêåÊ≠•Êõ¥Êñ∞ ref\n                        return newResult;\n                    });\n                }\n            } else {\n                console.log('Ë∑≥ÈÅéÁÑ°ÊïàÁµêÊûú');\n                if (data.success !== true) console.log('  - success ‰∏çÁÇ∫ true:', data.success);\n                if (!data.text) console.log('  - text ÁÇ∫Á©∫Êàñ‰∏çÂ≠òÂú®:', data.text);\n                if (data.error) console.log('  - ÈåØË™§‰ø°ÊÅØ:', data.error);\n            }\n        } catch (err) {\n            console.error('ÁôºÈÄÅÁØÄÈªûÂà∞ÂæåÁ´ØÊôÇÁôºÁîüÈåØË™§Ôºö', err);\n        }\n    };\n\n    const updateRecognizedText = (newText) => {\n        if (!newText || newText.trim() === '') return;\n        setResult(prevText => {\n            const lastText = lastRecognizedTextRef.current;\n            if (newText === \"Ë´ãÊâì‰∏ã‰∏ÄÂÄãÂ≠ó\") {\n                return prevText + '\\nË´ãÊâì‰∏ã‰∏ÄÂÄãÂ≠ó';\n            }\n            if (newText === lastText) {\n                return prevText;\n            }\n            return prevText + newText;\n        });\n    };\n\n    const handleStartRecording = () => {\n        if (!streamRef.current) {\n            alert('Èè°È†≠Â∞öÊú™Ê∫ñÂÇôÂ∞±Á∑í');\n            return;\n        }\n\n        setResult('');\n        lastRecognizedTextRef.current = '';\n        finalResultRef.current = '';\n        recordedChunksRef.current = [];\n\n        const mediaRecorder = new MediaRecorder(streamRef.current, { mimeType: 'video/webm' });\n\n        mediaRecorder.ondataavailable = event => {\n            if (event.data.size > 0) {\n                recordedChunksRef.current.push(event.data);\n                console.log(`Êî∂Âà∞ÈåÑË£ΩÁâáÊÆµ: ${event.data.size} bytes`);\n            }\n        };\n\n        mediaRecorder.onstop = async () => {            \n            if (recognitionIntervalRef.current) {\n                clearInterval(recognitionIntervalRef.current);\n                recognitionIntervalRef.current = null;\n            }\n            \n            try {\n                const blob = new Blob(recordedChunksRef.current, { type: 'video/webm' });\n                if (blob.size === 0) throw new Error('Ë¶ñË®äÊ™îÊ°àÁÇ∫Á©∫');\n\n                setTimeout(() => {\n                    setRecognitionStatus('idle');\n                    const finalResult = finalResultRef.current || 'ÁÑ°Ëæ®Ë≠òÁµêÊûú';\n                    console.log('ÊúÄÁµÇËæ®Ë≠òÁµêÊûú:', finalResult);\n                    \n                    if (editMessageID) {\n                        editMessage(editMessageID, finalResult);\n                    } else {\n                        addMessage(finalResult, 'customer');\n                    }\n                    \n                    navigate('/conversation');\n                }, 1000);\n            } catch (err) {\n                console.error('ËôïÁêÜÈåÑË£ΩÈåØË™§:', err);\n                alert('Ëæ®Ë≠òÂ§±Êïó: ' + err.message);\n                setRecognitionStatus('idle');\n            }\n        };\n\n        mediaRecorderRef.current = mediaRecorder;\n        mediaRecorder.start(1000);\n        setIsRecording(true);\n        setRecognitionStatus('recording');\n        startPeriodicRecognition();\n    };\n\n    const handleStopRecording = () => {\n        console.log('finalResultRef:', finalResultRef.current);\n        \n        if (mediaRecorderRef.current && mediaRecorderRef.current.state !== 'inactive') {\n            mediaRecorderRef.current.stop();\n        }\n\n        if (recognitionIntervalRef.current) {\n            clearInterval(recognitionIntervalRef.current);\n            recognitionIntervalRef.current = null;\n        }\n\n        setIsRecording(false);\n        setRecognitionStatus('processing');\n    };\n\n    const handleBack = () => {\n        if (mediaRecorderRef.current && isRecording) {\n            mediaRecorderRef.current.stop();\n        }\n\n        if (recognitionIntervalRef.current) {\n            clearInterval(recognitionIntervalRef.current);\n            recognitionIntervalRef.current = null;\n        }\n        \n        setIsRecording(false);\n        setRecognitionStatus('idle');\n        navigate('/conversation');\n    };\n\n    return (\n        <div className='sign-language-recognition-screen'>\n            <Header showBackButton={true} onBack={handleBack}/>\n            <div className='recognition-container'>\n                <div className='video-container'></div>\n                <video\n                    ref={videoRef}\n                    autoPlay\n                    playsInline\n                    muted\n                    style={{ display: 'none' }}\n                />\n                <canvas\n                    ref={canvasRef}\n                    className=\"overlay-canvas\"\n                    width={640}\n                    height={480}\n                />\n                {isProcessing && (\n                    <div className='processing-indicator'>\n                        Ëæ®Ë≠ò‰∏≠...\n                    </div>\n                )}\n            </div>\n            <div className={`recognition-result ${isRecording ? 'visible' : 'hidden'}`}>\n                <h3>Âç≥ÊôÇËæ®Ë≠òÁµêÊûúÔºö</h3>\n                <div\n                    ref={resultBoxRef}\n                    className={`result-text ${result ? 'has-content' : ''}`}\n                >\n                    {result ? (\n                        <div className=\"recognized-summary\">\n                            <div className=\"prompt\">Ë´ãÊâì‰∏ã‰∏ÄÂÄãÂ≠ó</div>\n                            <div><strong>ÁõÆÂâçÂ∑≤Ëº∏ÂÖ•Ôºö</strong> {result.replace(/Ë´ãÊâì‰∏ã‰∏ÄÂÄãÂ≠ó/g, '').trim()}</div>\n                        </div>\n                    ) : 'Á≠âÂæÖÊâãË™ûËæ®Ë≠ò...'}\n                </div>\n                {isRecording && <div className=\"live-indicator\">Âç≥ÊôÇÊõ¥Êñ∞‰∏≠</div>}\n            </div>\n            <div className='action-bar'>\n                {!isRecording ? (\n                    <button\n                        className='record-button'\n                        onClick={handleStartRecording}\n                        disabled={recognitionStatus === 'processing'}\n                    >\n                        <div className='button-inner'></div>\n                    </button>\n                ) : (\n                    <button\n                        className='record-button recording-active'\n                        onClick={handleStopRecording}\n                    >\n                        <div className='button-inner'></div>\n                    </button>\n                )}\n            </div>\n        </div>\n    );\n};\n                \nexport default SignLanguageRecognition;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}