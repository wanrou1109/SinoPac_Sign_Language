{"ast":null,"code":"var _jsxFileName = \"/Users/linwanjou/Documents/GitHub/SinoPac_Sign_Language/\\u6C38\\u8C50\\u7522\\u5B78/App/src/components/SignLanguageRecognition.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SignLanguageRecognition = () => {\n  _s();\n  var _location$state;\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    addMessage,\n    editMessage,\n    setRecognitionStatus,\n    recognitionStatus\n  } = useAppContext();\n  const [isRecording, setIsRecording] = useState(false);\n  const [result, setResult] = useState('');\n  const videoRef = useRef(null);\n  const editMessageID = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.messageID;\n\n  // 模擬鏡頭啟動\n  useEffect(() => {\n    const setupCamera = async () => {\n      try {\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n          const stream = await navigator.mediaDevices.getUserMedia({\n            video: true\n          });\n          if (videoRef.current) {\n            videoRef.current.srcObject = stream;\n          }\n        }\n      } catch (error) {\n        console.error('鏡頭開啟失敗:', error);\n      }\n    };\n    setupCamera();\n\n    // 清理函數（為了釋放鏡頭資源，避免記憶體洩漏和不必要的攝像頭佔用）\n    return () => {\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      }\n    };\n  }, []);\n\n  // 手語辨識\n  useEffect(() => {\n    if (isRecording) {\n      // 這裡要連到 API，目前模擬\n      const timer = setTimeout(() => {\n        setResult('（模擬）：我要辦理存款。');\n      }, 3000);\n      return () => clearTimeout(timer);\n    }\n  }, [isRecording]);\n\n  // 開始錄製\n  const handleStartRecording = () => {\n    setIsRecording(true);\n    setRecognitionStatus('recording');\n    setResult('');\n  };\n\n  // 停止錄製\n  const handleStopRecording = () => {\n    setIsRecording(false);\n    setRecognitionStatus('processing');\n\n    // 處理模擬延遲\n    setTimeout(() => {\n      setRecognitionStatus('idle');\n\n      // 編輯 or 新增？\n      if (editMessageID) {\n        editMessage(editMessageID, result);\n      } else {\n        addMessage(result, 'customer');\n      }\n\n      // 回 conversation page\n      navigate('/conversation');\n    }, 1500);\n  };\n\n  // 取消 and 返回\n  const handleCancel = () => {\n    setIsRecording(false);\n    setRecognitionStatus('idle');\n    navigate('/conversation');\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"sign-language-recognition-screen\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      title: selectedBranch || '永豐銀行',\n      onBack: handleCancel\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 90,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"recognition-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: videoRef,\n          autoPlay: true,\n          playsInline: true,\n          muted: true,\n          className: isRecording ? 'recording' : ''\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 21\n        }, this), isRecording && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"recording-indicator\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pulse-animation red\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              children: \"\\uFF08test\\uFF09\\u9304\\u88FD\\u4E2D\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 103,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 17\n      }, this), recognitionStatus === 'processing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"processing-indicator\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"spinner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"\\uFF08test\\uFF09\\u6B63\\u5728\\u8FA8\\u8B58\\u624B\\u8A9E...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 21\n      }, this), result && !isRecording && recognitionStatus !== 'processing' && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"result-display\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"\\u8FA8\\u8B58\\u7D50\\u679C:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: result\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"action-bar\",\n      children: !isRecording ? /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"record-button start\",\n        onClick: handleStartRecording,\n        disabled: recognitionStatus === 'processing',\n        children: \"\\u958B\\u59CB\\u9304\\u88FD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"recording-button stop\",\n        onClick: handleStopRecording,\n        children: \"\\u505C\\u6B62\\u9304\\u88FD\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 89,\n    columnNumber: 9\n  }, this);\n};\n_s(SignLanguageRecognition, \"0zsJJocyilR24ayZMQy9OrRvSWA=\", false, function () {\n  return [useNavigate, useLocation, useAppContext];\n});\n_c = SignLanguageRecognition;\nexport default SignLanguageRecognition;\nvar _c;\n$RefreshReg$(_c, \"SignLanguageRecognition\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useLocation","useAppContext","Header","jsxDEV","_jsxDEV","SignLanguageRecognition","_s","_location$state","navigate","location","addMessage","editMessage","setRecognitionStatus","recognitionStatus","isRecording","setIsRecording","result","setResult","videoRef","editMessageID","state","messageID","setupCamera","navigator","mediaDevices","getUserMedia","stream","video","current","srcObject","error","console","tracks","getTracks","forEach","track","stop","timer","setTimeout","clearTimeout","handleStartRecording","handleStopRecording","handleCancel","className","children","title","selectedBranch","onBack","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","playsInline","muted","onClick","disabled","_c","$RefreshReg$"],"sources":["/Users/linwanjou/Documents/GitHub/SinoPac_Sign_Language/永豐產學/App/src/components/SignLanguageRecognition.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\n\nconst SignLanguageRecognition = () => {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const {addMessage, editMessage, setRecognitionStatus, recognitionStatus} = useAppContext();\n    const[isRecording, setIsRecording] = useState(false);\n    const[result, setResult] = useState('');\n    const videoRef = useRef(null);\n    const editMessageID = location.state?.messageID;\n\n    // 模擬鏡頭啟動\n    useEffect(() => {\n        const setupCamera = async () => {\n            try {\n                if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n                    const stream = await navigator.mediaDevices.getUserMedia({video: true});\n                    if (videoRef.current) {\n                        videoRef.current.srcObject = stream;\n                    }\n                }\n            } catch (error) {\n                console.error('鏡頭開啟失敗:', error);\n            }\n        };\n        \n        setupCamera();\n\n        // 清理函數（為了釋放鏡頭資源，避免記憶體洩漏和不必要的攝像頭佔用）\n        return () => {\n            if(videoRef.current && videoRef.current.srcObject) {\n                const tracks = videoRef.current.srcObject.getTracks();\n                tracks.forEach(track => track.stop());\n            }\n        };\n    }, []);\n\n    // 手語辨識\n    useEffect(() => {\n        if(isRecording) {\n            // 這裡要連到 API，目前模擬\n            const timer = setTimeout(() => {\n                setResult('（模擬）：我要辦理存款。');\n            }, 3000);\n\n            return () => clearTimeout(timer);\n        }\n    }, [isRecording]);\n\n    // 開始錄製\n    const handleStartRecording = () => {\n        setIsRecording(true);\n        setRecognitionStatus('recording');\n        setResult('');\n    };\n\n    // 停止錄製\n    const handleStopRecording = () => {\n        setIsRecording(false);\n        setRecognitionStatus('processing');\n\n        // 處理模擬延遲\n        setTimeout(() => {\n            setRecognitionStatus('idle');\n\n            // 編輯 or 新增？\n            if (editMessageID) {\n                editMessage(editMessageID, result);\n            } else {\n                addMessage(result, 'customer');\n            }\n\n            // 回 conversation page\n            navigate('/conversation');\n        }, 1500);\n    };\n\n    // 取消 and 返回\n    const handleCancel = () => {\n        setIsRecording(false);\n        setRecognitionStatus('idle');\n        navigate('/conversation');\n    };\n\n    return (\n        <div className='sign-language-recognition-screen'>\n            <Header title = {selectedBranch || '永豐銀行'} onBack = {handleCancel} />\n\n            <div className='recognition-container'>\n                <div className='video-container'>\n                    <video\n                        ref={videoRef}\n                        autoPlay\n                        playsInline\n                        muted\n                        className = {isRecording ? 'recording' : ''} \n                    /> \n                    {isRecording && (\n                        <div className='recording-indicator'>\n                            <div className='pulse-animation red'>\n                                <span>（test）錄製中</span>\n                            </div>\n                        </div>\n                    )}\n                </div>\n\n                {recognitionStatus === 'processing' && (\n                    <div className='processing-indicator'>\n                        <div className='spinner'></div>\n                        <p>（test）正在辨識手語...</p>\n                    </div>\n                )}\n\n                {result && !isRecording && recognitionStatus !== 'processing' && (\n                    <div className=\"result-display\">\n                        <h3>辨識結果:</h3>\n                        <p>{result}</p>\n                    </div>\n                )}\n            </div>\n\n            <div className='action-bar'>\n                {!isRecording ? (\n                    <button \n                        className='record-button start'\n                        onClick={handleStartRecording}\n                        disabled={recognitionStatus === 'processing'}\n                    >\n                        開始錄製\n                    </button>\n                ) : (\n                    <button\n                        className='recording-button stop'\n                        onClick={handleStopRecording}\n                    >\n                        停止錄製\n                    </button>\n                )}\n            </div>\n        </div>\n    );\n\n};\n\nexport default SignLanguageRecognition;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}