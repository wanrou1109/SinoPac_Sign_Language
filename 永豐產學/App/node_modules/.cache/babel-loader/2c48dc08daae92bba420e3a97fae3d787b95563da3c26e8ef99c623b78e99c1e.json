{"ast":null,"code":"var _jsxFileName = \"/Users/johnsonleong/Desktop/DS/DS/Grade project/SinoPac_Sign_Language/\\u6C38\\u8C50\\u7522\\u5B78/App/src/components/SignLanguageRecognition.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\nimport '../styles/SignLanguageRecognition.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SignLanguageRecognition = () => {\n  _s();\n  var _location$state;\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    addMessage,\n    editMessage,\n    setRecognitionStatus,\n    recognitionStatus\n  } = useAppContext();\n  const [isRecording, setIsRecording] = useState(false);\n  const [result, setResult] = useState('');\n  const editMessageID = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.messageID;\n  const {\n    selectedBranch\n  } = location.state || {};\n  const recognitionIntervalRef = useRef(null);\n  const lastRecognizedTextRef = useRef('');\n\n  // 不再需要 setupCamera 與 streamRef\n\n  useEffect(() => {\n    if (isRecording) {\n      recognitionIntervalRef.current = setInterval(async () => {\n        try {\n          const res = await fetch('/getRes');\n          const data = await res.json();\n          const newText = data.result;\n          setResult(newText || '');\n        } catch (err) {\n          console.error('取得辨識結果錯誤:', err);\n        }\n      }, 2000);\n    }\n    return () => {\n      clearInterval(recognitionIntervalRef.current);\n    };\n  }, [isRecording]);\n  const handleStartRecording = () => {\n    setIsRecording(true);\n    setRecognitionStatus('recording');\n  };\n  const handleStopRecording = () => {\n    setIsRecording(false);\n    setRecognitionStatus('idle');\n    if (editMessageID) {\n      editMessage(editMessageID, result);\n    } else {\n      addMessage(result, 'customer');\n    }\n    navigate('/conversation', {\n      state: {\n        selectedBranch\n      }\n    });\n  };\n  const handleCancel = () => {\n    setIsRecording(false);\n    setRecognitionStatus('idle');\n    navigate('/conversation', {\n      state: {\n        selectedBranch\n      }\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"sign-language-recognition-screen\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      title: selectedBranch || '手語／語音辨識系統',\n      showBackButton: handleCancel\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"recognition-container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"/video_feed\",\n          alt: \"\\u5373\\u6642\\u5F71\\u50CF\\u4E32\\u6D41\",\n          className: `mirror-video ${isRecording ? 'recording' : ''}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 20\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"recognition-result\",\n          children: result\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 20\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"action-bar\",\n      children: !isRecording ? /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"record-button\",\n        onClick: handleStartRecording,\n        disabled: recognitionStatus === 'processing',\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-inner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"record-button recording-active\",\n        onClick: handleStopRecording,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-inner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 90,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 9\n  }, this);\n};\n_s(SignLanguageRecognition, \"NUFodbkxGwoVqfvAqGyGHq71B98=\", false, function () {\n  return [useNavigate, useLocation, useAppContext];\n});\n_c = SignLanguageRecognition;\nexport default SignLanguageRecognition;\nvar _c;\n$RefreshReg$(_c, \"SignLanguageRecognition\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useLocation","useAppContext","Header","jsxDEV","_jsxDEV","SignLanguageRecognition","_s","_location$state","navigate","location","addMessage","editMessage","setRecognitionStatus","recognitionStatus","isRecording","setIsRecording","result","setResult","editMessageID","state","messageID","selectedBranch","recognitionIntervalRef","lastRecognizedTextRef","current","setInterval","res","fetch","data","json","newText","err","console","error","clearInterval","handleStartRecording","handleStopRecording","handleCancel","className","children","title","showBackButton","fileName","_jsxFileName","lineNumber","columnNumber","src","alt","onClick","disabled","_c","$RefreshReg$"],"sources":["/Users/johnsonleong/Desktop/DS/DS/Grade project/SinoPac_Sign_Language/永豐產學/App/src/components/SignLanguageRecognition.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\nimport '../styles/SignLanguageRecognition.css';\n\nconst SignLanguageRecognition = () => {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const { addMessage, editMessage, setRecognitionStatus, recognitionStatus } = useAppContext();\n    const [isRecording, setIsRecording] = useState(false);\n    const [result, setResult] = useState('');\n    const editMessageID = location.state?.messageID;\n    const { selectedBranch } = location.state || {};\n\n    const recognitionIntervalRef = useRef(null);\n    const lastRecognizedTextRef = useRef('');\n\n    // 不再需要 setupCamera 與 streamRef\n\n    useEffect(() => {\n        if (isRecording) {\n            recognitionIntervalRef.current = setInterval(async () => {\n                try {\n                    const res = await fetch('/getRes');\n                    const data = await res.json();\n                    const newText = data.result;\n                    setResult(newText || '');\n                } catch (err) {\n                    console.error('取得辨識結果錯誤:', err);\n                }\n            }, 2000);\n        }\n\n        return () => {\n            clearInterval(recognitionIntervalRef.current);\n        };\n    }, [isRecording]);\n\n\n    const handleStartRecording = () => {\n        setIsRecording(true);\n        setRecognitionStatus('recording');\n    };\n\n    const handleStopRecording = () => {\n        setIsRecording(false);\n        setRecognitionStatus('idle');\n        if (editMessageID) {\n            editMessage(editMessageID, result);\n        } else {\n            addMessage(result, 'customer');\n        }\n        navigate('/conversation', { state: { selectedBranch } });\n    };\n\n    const handleCancel = () => {\n        setIsRecording(false);\n        setRecognitionStatus('idle');\n        navigate('/conversation', { state: { selectedBranch } });\n    };\n\n    return (\n        <div className='sign-language-recognition-screen'>\n            <Header title={selectedBranch || '手語／語音辨識系統'} showBackButton={handleCancel} />\n            <div className='recognition-container'>\n                <div className='video-container'>\n                   <img\n                    src=\"/video_feed\"\n                    alt=\"即時影像串流\"\n                    className={`mirror-video ${isRecording ? 'recording' : ''}`}\n                   />\n                   <div className=\"recognition-result\">{result}</div>\n                </div>\n            </div>\n            <div className='action-bar'>\n                {!isRecording ? (\n                    <button\n                        className='record-button'\n                        onClick={handleStartRecording}\n                        disabled={recognitionStatus === 'processing'}\n                    >\n                        <div className='button-inner'></div>\n                    </button>\n                ) : (\n                    <button\n                        className='record-button recording-active'\n                        onClick={handleStopRecording}\n                    >\n                        <div className='button-inner'></div>\n                    </button>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default SignLanguageRecognition;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}