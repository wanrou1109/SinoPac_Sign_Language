{"ast":null,"code":"var _jsxFileName = \"/Users/johnsonleong/Desktop/DS/DS/Grade project/SinoPac_Sign_Language/\\u6C38\\u8C50\\u7522\\u5B78/App/src/components/SignLanguageRecognition.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\nimport '../styles/SignLanguageRecognition.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst SignLanguageRecognition = () => {\n  _s();\n  var _location$state;\n  const navigate = useNavigate();\n  const location = useLocation();\n  const {\n    addMessage,\n    editMessage,\n    setRecognitionStatus,\n    recognitionStatus\n  } = useAppContext();\n  const [isRecording, setIsRecording] = useState(false);\n  const [result, setResult] = useState('');\n  const editMessageID = (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.messageID;\n  const {\n    selectedBranch\n  } = location.state || {};\n  const recognitionIntervalRef = useRef(null);\n  const lastRecognizedTextRef = useRef('');\n  const videoRef = useRef(null);\n\n  // 不再需要 setupCamera 與 streamRef\n\n  useEffect(() => {\n    navigator.mediaDevices.getUserMedia({\n      video: true\n    }).then(stream => {\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n      }\n    }).catch(err => {\n      console.error('取得攝影機影像失敗:', err);\n    });\n  }, []);\n  useEffect(() => {\n    if (isRecording) {\n      recognitionIntervalRef.current = setInterval(async () => {\n        try {\n          const res = await fetch('/getRes');\n          const data = await res.json();\n          const newText = data.result;\n          setResult(newText || '');\n        } catch (err) {\n          console.error('取得辨識結果錯誤:', err);\n        }\n      }, 2000);\n    }\n    return () => {\n      clearInterval(recognitionIntervalRef.current);\n    };\n  }, [isRecording]);\n  const handleStartRecording = () => {\n    setIsRecording(true);\n    setRecognitionStatus('recording');\n  };\n  const handleStopRecording = () => {\n    setIsRecording(false);\n    setRecognitionStatus('idle');\n    if (editMessageID) {\n      editMessage(editMessageID, result);\n    } else {\n      addMessage(result, 'customer');\n    }\n    navigate('/conversation', {\n      state: {\n        selectedBranch\n      }\n    });\n  };\n  const handleCancel = () => {\n    setIsRecording(false);\n    setRecognitionStatus('idle');\n    navigate('/conversation', {\n      state: {\n        selectedBranch\n      }\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"sign-language-recognition-screen\",\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      title: selectedBranch || '手語／語音辨識系統',\n      showBackButton: handleCancel\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"recognition-container\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"video-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"video\", {\n          ref: videoRef,\n          autoPlay: true,\n          muted: true,\n          className: `mirror-video ${isRecording ? 'recording' : ''}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 20\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"recognition-result\",\n          children: result\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 20\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"action-bar\",\n      children: !isRecording ? /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"record-button\",\n        onClick: handleStartRecording,\n        disabled: recognitionStatus === 'processing',\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-inner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 106,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 21\n      }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"record-button recording-active\",\n        onClick: handleStopRecording,\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"button-inner\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 9\n  }, this);\n};\n_s(SignLanguageRecognition, \"xF6XVstR1+8a8SGuPw1hiTrMbdY=\", false, function () {\n  return [useNavigate, useLocation, useAppContext];\n});\n_c = SignLanguageRecognition;\nexport default SignLanguageRecognition;\nvar _c;\n$RefreshReg$(_c, \"SignLanguageRecognition\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useLocation","useAppContext","Header","jsxDEV","_jsxDEV","SignLanguageRecognition","_s","_location$state","navigate","location","addMessage","editMessage","setRecognitionStatus","recognitionStatus","isRecording","setIsRecording","result","setResult","editMessageID","state","messageID","selectedBranch","recognitionIntervalRef","lastRecognizedTextRef","videoRef","navigator","mediaDevices","getUserMedia","video","then","stream","current","srcObject","catch","err","console","error","setInterval","res","fetch","data","json","newText","clearInterval","handleStartRecording","handleStopRecording","handleCancel","className","children","title","showBackButton","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","muted","onClick","disabled","_c","$RefreshReg$"],"sources":["/Users/johnsonleong/Desktop/DS/DS/Grade project/SinoPac_Sign_Language/永豐產學/App/src/components/SignLanguageRecognition.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate, useLocation } from 'react-router-dom';\nimport { useAppContext } from '../contexts/AppContext.js';\nimport Header from './Header.js';\nimport '../styles/SignLanguageRecognition.css';\n\nconst SignLanguageRecognition = () => {\n    const navigate = useNavigate();\n    const location = useLocation();\n    const { addMessage, editMessage, setRecognitionStatus, recognitionStatus } = useAppContext();\n    const [isRecording, setIsRecording] = useState(false);\n    const [result, setResult] = useState('');\n    const editMessageID = location.state?.messageID;\n    const { selectedBranch } = location.state || {};\n\n    const recognitionIntervalRef = useRef(null);\n    const lastRecognizedTextRef = useRef('');\n    const videoRef = useRef(null);\n\n    // 不再需要 setupCamera 與 streamRef\n\n    useEffect(() => {\n        navigator.mediaDevices.getUserMedia({ video: true })\n            .then((stream) => {\n                if (videoRef.current) {\n                    videoRef.current.srcObject = stream;\n                }\n            })\n            .catch((err) => {\n                console.error('取得攝影機影像失敗:', err);\n            });\n    }, []);\n\n    useEffect(() => {\n        if (isRecording) {\n            recognitionIntervalRef.current = setInterval(async () => {\n                try {\n                    const res = await fetch('/getRes');\n                    const data = await res.json();\n                    const newText = data.result;\n                    setResult(newText || '');\n                } catch (err) {\n                    console.error('取得辨識結果錯誤:', err);\n                }\n            }, 2000);\n        }\n\n        return () => {\n            clearInterval(recognitionIntervalRef.current);\n        };\n    }, [isRecording]);\n\n\n    const handleStartRecording = () => {\n        setIsRecording(true);\n        setRecognitionStatus('recording');\n    };\n\n    const handleStopRecording = () => {\n        setIsRecording(false);\n        setRecognitionStatus('idle');\n        if (editMessageID) {\n            editMessage(editMessageID, result);\n        } else {\n            addMessage(result, 'customer');\n        }\n        navigate('/conversation', { state: { selectedBranch } });\n    };\n\n    const handleCancel = () => {\n        setIsRecording(false);\n        setRecognitionStatus('idle');\n        navigate('/conversation', { state: { selectedBranch } });\n    };\n\n    return (\n        <div className='sign-language-recognition-screen'>\n            <Header title={selectedBranch || '手語／語音辨識系統'} showBackButton={handleCancel} />\n            <div className='recognition-container'>\n                <div className='video-container'>\n                   {/* 若使用前端攝影機畫面： */}\n                   <video\n                    ref={videoRef}\n                    autoPlay\n                    muted\n                    className={`mirror-video ${isRecording ? 'recording' : ''}`}\n                   />\n\n                   {/* 若改為後端串流模式（例如 Flask handlanRes 路由）則改用 img：\n                   <img\n                    src=\"/handlanRes\"\n                    alt=\"即時影像\"\n                    className={`mirror-video ${isRecording ? 'recording' : ''}`}\n                   />\n                   */}\n                   <div className=\"recognition-result\">{result}</div>\n                </div>\n            </div>\n            <div className='action-bar'>\n                {!isRecording ? (\n                    <button\n                        className='record-button'\n                        onClick={handleStartRecording}\n                        disabled={recognitionStatus === 'processing'}\n                    >\n                        <div className='button-inner'></div>\n                    </button>\n                ) : (\n                    <button\n                        className='record-button recording-active'\n                        onClick={handleStopRecording}\n                    >\n                        <div className='button-inner'></div>\n                    </button>\n                )}\n            </div>\n        </div>\n    );\n};\n\nexport default SignLanguageRecognition;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}